<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Gemini Flask Bot - AI Assistant</title>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
<style>
    /* RESET & BASE */
    * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; }
    body { background: linear-gradient(135deg, #667eea, #764ba2); min-height: 100vh; display: flex; align-items: center; justify-content: center; padding: 20px; }

    /* CONTAINER */
    .container {
        width: 100%; max-width: 900px; border-radius: 20px;
        background: rgba(255,255,255,0.9); backdrop-filter: blur(15px);
        box-shadow: 0 20px 60px rgba(0,0,0,0.2);
        padding: 40px;
        border: 1px solid rgba(255,255,255,0.2);
        display: flex; flex-direction: column;
    }

    /* HEADER */
    .header { text-align: center; margin-bottom: 30px; }
    .header h1 { font-size: 2.5rem; color: #4285f4; display: flex; justify-content: center; align-items: center; gap: 15px; }
    .header p { font-size: 1.1rem; color: #555; margin-bottom: 15px; }
    .status-indicator {
        display: inline-flex; align-items: center; gap: 8px;
        background: #e8f5e8; color: #2e7d32; padding: 8px 16px; border-radius: 20px; font-weight: 500;
    }

    /* CHAT AREA */
    .chat-container {
        flex: 1; height: 500px; overflow-y: auto; padding: 20px;
        background: #fefefe; border-radius: 15px; border: 1px solid #e1e5e9;
        margin-bottom: 25px; scroll-behavior: smooth;
    }

    .message { margin-bottom: 20px; animation: fadeIn 0.3s ease-in; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px);} to { opacity: 1; transform: translateY(0);} }

    .message-bubble { max-width: 80%; padding: 15px 20px; border-radius: 20px; font-size: 1rem; line-height: 1.5; position: relative; word-wrap: break-word; }
    .user-message { margin-left: auto; background: linear-gradient(135deg,#4285f4,#34a853); color: #fff; border-bottom-right-radius: 5px; }
    .bot-message { background: #fff; color: #333; border: 1px solid #e1e5e9; border-bottom-left-radius: 5px; box-shadow: 0 2px 8px rgba(0,0,0,0.08); }
    .message-time { font-size: 0.75rem; opacity: 0.6; margin-top: 5px; }

    /* TYPING */
    .typing-indicator { display: none; align-items: center; gap: 10px; font-style: italic; color: #666; margin-bottom: 15px; }
    .typing-dots { display: flex; gap: 4px; }
    .dot { width: 8px; height: 8px; border-radius: 50%; background: #4285f4; animation: typing 1.4s infinite ease-in-out; }
    .dot:nth-child(1){ animation-delay:-0.32s; } .dot:nth-child(2){ animation-delay:-0.16s; }
    @keyframes typing { 0%,80%,100%{transform:scale(0);opacity:0.5;}40%{transform:scale(1);opacity:1;} }

    /* WELCOME MESSAGE */
    .welcome-message { text-align: center; color: #666; font-style: italic; padding: 20px; border-radius: 12px; background: linear-gradient(135deg,#f8f9fa,#e9ecef); }

    /* INPUT */
    .input-container { display: flex; gap: 12px; align-items: center; }
    .input-wrapper { position: relative; flex: 1; }
    #messageInput {
        width: 100%; padding: 16px 50px 16px 20px; border-radius: 25px;
        border: 2px solid #e1e5e9; font-size: 1rem; outline: none; transition: all 0.3s ease;
        background: #fff;
    }
    #messageInput:focus { border-color:#4285f4; box-shadow: 0 0 0 3px rgba(66,133,244,0.15); }

    .send-btn {
        position: absolute; right: 8px; top: 50%; transform: translateY(-50%);
        width: 36px; height: 36px; border-radius: 50%; border: none;
        background: #4285f4; color: #fff; cursor: pointer;
        display: flex; align-items: center; justify-content: center; transition: all 0.3s ease;
    }
    .send-btn:hover { background: #3367d6; transform: translateY(-50%) scale(1.1);}
    .send-btn:disabled { background:#ccc; cursor:not-allowed; }

    /* ACTION BUTTONS */
    .action-buttons { display: flex; gap: 10px; }
    .btn { padding: 12px 20px; border-radius: 25px; border:none; cursor:pointer; font-weight:600; display:flex; align-items:center; gap:8px; transition: all 0.3s ease; }
    .btn-clear { background:#ea4335; color:#fff; } .btn-clear:hover { background:#d33b2c; transform: translateY(-2px); }
    .btn-voice { background:#34a853; color:#fff; } .btn-voice:hover { background:#2e7d32; transform: translateY(-2px); }

    /* RESPONSIVE */
    @media (max-width:768px){
        .container{padding:20px;margin:10px;}
        .header h1{font-size:2rem;}
        .chat-container{height:400px;}
        .message-bubble{max-width:90%;padding:12px 16px;}
        .input-container{flex-direction:column;}
        .action-buttons{justify-content:center;width:100%;}
    }

    /* DARK MODE */
    @media (prefers-color-scheme: dark){
        body{background: linear-gradient(135deg,#1a1a2e,#16213e);}
        .container{background: rgba(30,30,30,0.95); color:#e0e0e0;}
        .chat-container{background:#2a2a2a; border-color:#444;}
        .bot-message{background:#3a3a3a; color:#e0e0e0; border-color:#555;}
        #messageInput{background:#3a3a3a; color:#e0e0e0; border-color:#555;}
        .status-indicator{background:#2e2e2e; color:#b0ffb0;}
        .welcome-message{background:#3a3a3a; color:#ccc;}
    }
</style>
</head>
<body>
<div class="container">
    <div class="header">
        <h1><i class="fas fa-robot"></i>Gemini Flask Bot</h1>
        <p>Powered by Google's Gemini AI - Ask me anything!</p>
        <div class="status-indicator"><i class="fas fa-circle"></i> Online & Ready</div>
    </div>

    <div class="chat-container" id="chatContainer">
        <div class="welcome-message"><i class="fas fa-sparkles"></i> Welcome! I'm your AI assistant powered by Gemini. How can I help you today?</div>
    </div>

    <div class="typing-indicator" id="typingIndicator">
        <i class="fas fa-robot"></i> AI is thinking
        <div class="typing-dots"><div class="dot"></div><div class="dot"></div><div class="dot"></div></div>
    </div>

    <div class="input-container">
        <div class="input-wrapper">
            <input type="text" id="messageInput" placeholder="Type your message here..." maxlength="10000">
            <button class="send-btn" id="sendBtn" onclick="sendMessage()"><i class="fas fa-paper-plane"></i></button>
        </div>
        <div class="action-buttons">
            <button class="btn btn-clear" onclick="clearChat()"><i class="fas fa-trash-alt"></i> Clear</button>
            <button class="btn btn-voice" onclick="toggleVoice()" title="Voice input (coming soon)"><i class="fas fa-microphone"></i> Voice</button>
        </div>
    </div>
</div>
</body>
</htmlssageInput');
        const sendBtn = document.getElementById('sendBtn');
        const typingIndicator = document.getElementById('typingIndicator');

        // Auto-focus input
        messageInput.focus();

        function addMessage(message, isUser = false, timestamp = null) {
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message';
            
            const bubbleDiv = document.createElement('div');
            bubbleDiv.className = `message-bubble ${isUser ? 'user-message' : 'bot-message'}`;
            
            // Use textContent to prevent XSS
            bubbleDiv.textContent = message;
            
            // Add timestamp
            if (timestamp || !isUser) {
                const timeDiv = document.createElement('div');
                timeDiv.className = 'message-time';
                timeDiv.textContent = timestamp || new Date().toLocaleTimeString();
                bubbleDiv.appendChild(timeDiv);
            }
            
            messageDiv.appendChild(bubbleDiv);
            chatContainer.appendChild(messageDiv);
            
            // Remove welcome message if it exists
            const welcomeMsg = chatContainer.querySelector('.welcome-message');
            if (welcomeMsg && !isUser) {
                welcomeMsg.remove();
            }
            
            scrollToBottom();
        }

        function showTyping() {
            typingIndicator.style.display = 'flex';
            scrollToBottom();
        }

        function hideTyping() {
            typingIndicator.style.display = 'none';
        }

        function scrollToBottom() {
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        function setLoading(loading) {
            sendBtn.disabled = loading;
            messageInput.disabled = loading;
            
            if (loading) {
                sendBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
                showTyping();
            } else {
                sendBtn.innerHTML = '<i class="fas fa-paper-plane"></i>';
                hideTyping();
            }
        }

        async function sendMessage() {
            const message = messageInput.value.trim();
            if (!message || sendBtn.disabled) return;

            // Add user message
            addMessage(message, true);
            messageInput.value = '';
            setLoading(true);

            try {
                const response = await fetch('/chat', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ message: message })
                });

                const data = await response.json();
                
                if (data.success) {
                    addMessage(data.response);
                } else {
                    addMessage('❌ Error: ' + (data.error || 'Unknown error occurred'));
                }
            } catch (error) {
                addMessage('❌ Network error: Failed to send message. Please check your connection and try again.');
                console.error('Error:', error);
            } finally {
                setLoading(false);
                messageInput.focus();
            }
        }

        async function clearChat() {
            if (!confirm('Are you sure you want to clear the conversation?')) {
                return;
            }

            try {
                const response = await fetch('/clear', { method: 'POST' });
                if (response.ok) {
                    chatContainer.innerHTML = `
                        <div class="welcome-message">
                            <i class="fas fa-sparkles"></i>
                            Welcome back! I'm ready for a new conversation. How can I help you?
                        </div>
                    `;
                }
            } catch (error) {
                console.error('Error clearing chat:', error);
                alert('Failed to clear chat. Please try again.');
            }
        }

        function toggleVoice() {
            alert('Voice input feature coming soon! 🎤');
        }

        // Enter key to send message
        messageInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        });

        // Character counter
        messageInput.addEventListener('input', function() {
            const remaining = 10000 - this.value.length;
            if (remaining < 100) {
                this.style.borderColor = remaining < 50 ? '#ea4335' : '#ff9800';
            } else {
                this.style.borderColor = '#e1e5e9';
            }
        });

        // Auto-resize input on mobile
        if (window.innerWidth <= 768) {
            messageInput.addEventListener('focus', function() {
                setTimeout(() => {
                    document.body.scrollTop = document.body.scrollHeight;
                }, 300);
            });
        }
    </script>
</body>
</html>
